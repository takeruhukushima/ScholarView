# 分散型学術査読・熟議アプリケーション (DeSci) 開発要件定義書

あなたは優秀なフロントエンドエンジニアおよびUXデザイナーです。以下の要件定義に従って、React/Next.js (TypeScript) および Tailwind CSS を使用してWebアプリケーションのUIとロジックを実装してください。

## 1. プロジェクト概要とアーキテクチャ
AT Protocolを活用し、研究者のアイデア検討や論文のオープンな査読（Peer Review）を行うDeSciアプリケーションです。
- **データ構造:** 論文本体は独自Lexicon (`sci.peer.article`) で管理。ブロック構造（Notionライク）を採用。
- **ソーシャル連携:** 査読コメントや熟議、いいね等のアクションはすべてBluesky標準Lexiconに依存させ、PDS（Personal Data Server）と通信します。

## 2. デザインシステム（配色・タイポグラフィ）
学術的な信頼感と、Blueskyとの親和性を両立させたモダンな配色を使用してください。
- **Background:** `#F8FAFC` (Slate 50) - 論文が読みやすいオフホワイト
- **Surface/Card:** `#FFFFFF` - エディタやサイドバーの背景
- **Primary/Brand:** `#0085FF` - Blueskyブルー（ボタン、アクティブ状態、リンク）
- **Text Primary:** `#0F172A` (Slate 900) - メインテキスト（高い可読性）
- **Text Secondary:** `#64748B` (Slate 500) - 補足テキストやメタデータ
- **Highlight (Annotation):** `#FEF08A` (Yellow 200) - テキストハイライト・インラインコメント用
- **Typography:** フォントは視認性の高いサンセリフ体（Inter等）をベースとし、TeX/コードブロック部分は等幅フォント（Fira Code等）を指定。

## 3. 全体レイアウト構成 (3カラム構成)
画面幅いっぱいに広がるダッシュボード型の3カラムレイアウトを構築してください。

### ① 左サイドバー（ディレクトリ＆ファイル管理）
- **役割:** プロジェクト内のファイルツリー表示とナビゲーション。
- **機能:**
  - ディレクトリ構造の表示（フォルダの展開/折りたたみ）。
  - Blueskyアカウントのログイン状態表示。
- **オブジェクト指向的インポートの起点:** ここにあるファイル群（`.tex` や `.md`）は、中央のエディタ内でモジュールとしてインポート（参照）可能であること。

### ② 中央パネル（ハイブリッド・ブロックエディタ）
- **役割:** 論文の執筆と、AT Protocolへの同期管理。
- **機能:**
  - **Notionライクなブロック編集:** テキスト、数式、画像などをブロック単位で編集可能。
  - **モジュール・インポート機能:** Markdown編集時もTeX編集時も、左サイドバーのファイルパスを指定して別のファイルをブロックとして読み込めるようにする。（例: `\input{/methods/rf_sputtering.tex}` や `{{import: /methods/rf_sputtering.md}}` と入力すると、そのファイルの内容がブロックとして展開される）
  - **Bluesky同期トグル（Post Management）:** 各ブロック、またはドキュメント全体のメタデータとして「Blueskyポスト同期状態」を管理するUI。
    - 未投稿のものを「公開（Broadcast）」するボタン。
    - 投稿済みのものを「非公開（Bluesky上からポストを削除：Delete Record）」にする機能。
    - 編集内容をBlueskyのポストに「反映（アップデート）」する機能。
  - **ハイライト＆フックUI:** テキストを選択（ドラッグ）した際、「Blueskyで熟議する」ポップアップツールチップを表示。

### ③ 右パネル（プレビュー＆熟議）
- **役割:** レンダリング結果の確認と、Blueskyプロトコルを通じたインタラクション。
- **タブ切り替え機能:**
  - **「Preview」タブ:** LaTeXやMarkdownがレンダリングされたプレビュー画面。
  - **「Discussion」タブ:** BlueskyのタイムラインUI。
- **Discussionタブの要件（フル機能連携）:**
  - 中央エディタでハイライトされた箇所に紐づくBlueskyのスレッドを表示。
  - スレッド内での「いいね (Like)」「リポスト (Repost)」「リプライ (Reply)」のアクションボタンを実装（`app.bsky.feed.*` のLexiconを利用する想定のUI）。

## 4. チュートリアル（オンボーディング）コンポーネントの実装
初回訪問ユーザーが複雑なシステムを理解できるよう、ステップバイステップのチュートリアルUI（`react-joyride` などを想定）を実装してください。
以下のステップをハイライトするフローを作成してください：
1. 「左サイドバーでファイル構造を管理します」
2. 「中央エディタでは、ブロック単位で執筆し、別ファイルをインポートすることも可能です」
3. 「テキストを選択すると、特定の箇所に対してBluesky上で査読コメントを募ることができます」
4. 「右パネルでプレビューと、世界中からのフィードバック（熟議）を確認しましょう」
5. 「同期トグルを使って、どの内容をBlueskyに公開するか制御できます」

## 5. 最初のタスク
まずは、この3カラムレイアウトのシェル（外枠）と、指定したカラーパレットを適用した静的なモックアップを作成してください。その後、チュートリアル機能の実装に進んでください。
